Youth Ministry Hibernate
================================

Steps to run project
---------------------

1.  Import the project into eclipse as a maven project using Maven -> Existing maven project in the import wizard.
2.  Navigate to the hibernate config file and modify settings so that they are relevant to your db instance.
    This file should be located at:
        /src/main/webapp/WEB-INF/spring/spring-hibernate

    Modify the following lines:
        <bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close">
            <property name="driverClassName" value="com.mysql.jdbc.Driver"/>
            <property name="url" value="{db conneciton url}"/>
            <property name="username" value="{dbusername}"/>
            <property name="password" value="{dbpassword}"/>
        </bean>

    In order to create the initial tables uncomment the line shown below so that the hibernate.hbm2dll.auto
    property is set to create
        <property name="hibernateProperties">
            <props>
                <prop key="hibernate.dialect">org.hibernate.dialect.MySQLDialect</prop>
                <prop key="hibernate.show_sql">true</prop>
                <prop key="hibernate.enable_lazy_load_no_trans">true</prop>
                <!--<prop key="hibernate.hbm2ddl.auto">create</prop>-->
            </props>
        </property>
3.  Once the above changes have been made right click on the project name and click on maven->update project
    This will get all the required jars to run the project as well as some needed for future development.
4.  Since maven has not yet been configured to run on a server outside of eclipse then just run it using eclipse
    by right clicking on the project and clicking on run as -> run on server.  If you don't see this option
    you may have to add the web project facet to the project.
5.  After running the project you should have your schema created in the database specified in the
    connection url specified above.
6.  After it has finished starting up go back to the hibernate configuration file and comment out the
    line you uncommented above so that it will not create the schema every time.  You may also switch the prop
    value to be update instead and it will work.
7.  There has been a few changes to the schema due to a bug with the join tables generated by hibernate.  To fix this
    run the following alter table scripts in your mysql instance.
        drop table `EVENT_GROUP`;
        CREATE TABLE `EVENT_GROUP` (
              `EVENT_ID` bigint(20) NOT NULL,
              `GROUP_ID` bigint(20) NOT NULL,
              KEY `FKD114985A90527599` (`EVENT_ID`),
              KEY `FKD114985A9E07AF79` (`GROUP_ID`),
              CONSTRAINT `FKD114985A9E07AF79` FOREIGN KEY (`GROUP_ID`) REFERENCES `GROUP_DETAILS` (`groupId`),
              CONSTRAINT `FKD114985A90527599` FOREIGN KEY (`EVENT_ID`) REFERENCES `EVENT` (`EVENT_ID`)
        ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
        drop table `GROUP_PAGE_CONTENT`;
        CREATE TABLE `GROUP_PAGE_CONTENT` (
              `PAGE_CONTENT_ID` bigint(20) NOT NULL,
              `GROUP_ID` bigint(20) NOT NULL,
              KEY `FKC122C0899E07AF79` (`GROUP_ID`),
              KEY `FKC122C089BC9FC1A` (`PAGE_CONTENT_ID`),
              CONSTRAINT `FKC122C089BC9FC1A` FOREIGN KEY (`PAGE_CONTENT_ID`) REFERENCES `PageContent` (`pageContentId`),
              CONSTRAINT `FKC122C0899E07AF79` FOREIGN KEY (`GROUP_ID`) REFERENCES `GROUP_DETAILS` (`groupId`)
        ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
        drop table `USER_GROUP`;
        CREATE TABLE `USER_GROUP` (
              `USER_ID` bigint(20) NOT NULL,
              `GROUP_ID` bigint(20) NOT NULL,
              KEY `FKC62E00EB1C6957DB` (`USER_ID`),
              KEY `FKC62E00EB9E07AF79` (`GROUP_ID`),
              CONSTRAINT `FKC62E00EB9E07AF79` FOREIGN KEY (`GROUP_ID`) REFERENCES `GROUP_DETAILS` (`groupId`),
              CONSTRAINT `FKC62E00EB1C6957DB` FOREIGN KEY (`USER_ID`) REFERENCES `user` (`USER_ID`)
        ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
        drop table `USER_ROLES`;
        CREATE TABLE `USER_ROLES` (
              `user_USER_ID` bigint(20) NOT NULL,
              `roles_id` bigint(20) NOT NULL,
              KEY `FK734299497758EF67` (`user_USER_ID`),
              KEY `FK7342994915570C54` (`roles_id`),
              CONSTRAINT `FK7342994915570C54` FOREIGN KEY (`roles_id`) REFERENCES `roles` (`id`),
              CONSTRAINT `FK734299497758EF67` FOREIGN KEY (`user_USER_ID`) REFERENCES `user` (`USER_ID`)
        ) ENGINE=InnoDB DEFAULT CHARSET=latin1;

        -- alter table script for roles table
        ALTER TABLE `YouthMinistry`.`roles` 
        CHANGE COLUMN `name` `name` VARCHAR(255) NOT NULL  
        , ADD UNIQUE INDEX `role_name_UNIQUE` (`name` ASC);
    
    After the alter table has completed go ahead and add the necessary data for user roles with this query:
        -- create role data
        insert into YouthMinistry.roles(role) values ('ROLE_ADMIN');
        insert into YouthMinistry.roles(role) values ('ROLE_USER');
8.  After this has been completed your instance should be up and running go ahead and create a user using the 
    signup link.

